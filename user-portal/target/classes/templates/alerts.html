<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>HeartGuard - Alertas</title>
    <link rel="stylesheet" href="/css/main.css">
    <style>
        .user-badge {
            display: inline-block;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .alerts-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .alert-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #0ea5e9;
        }
        .alert-card.high {
            border-left-color: #ef4444;
        }
        .alert-card.medium {
            border-left-color: #f59e0b;
        }
        .alert-card.low {
            border-left-color: #10b981;
        }
        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .alert-id {
            font-size: 0.9rem;
            color: #64748b;
        }
        .alert-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .alert-status.active {
            background: #fef3c7;
            color: #92400e;
        }
        .alert-status.ack {
            background: #dbeafe;
            color: #1e40af;
        }
        .alert-status.resolved {
            background: #d1fae5;
            color: #065f46;
        }
        .alert-description {
            margin: 0.5rem 0;
            color: #334155;
        }
        .alert-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #64748b;
        }
        .btn-ack {
            background: #0ea5e9;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .btn-ack:hover {
            background: #0284c7;
        }
    </style>
</head>
<body>
<header class="top-nav">
    <div class="logo">HeartGuard</div>
    <nav>
        <a href="/dashboard">Pacientes</a>
        <a href="/alerts" class="active">Alertas</a>
        <a href="/devices">Dispositivos</a>
        <a href="/profile">Mi Perfil</a>
        <form method="post" action="/logout" class="inline-form">
            <button type="submit" class="link-button">Cerrar sesión</button>
        </form>
    </nav>
</header>
<main class="content">
    <section class="panel">
        <div>
            <span class="user-badge" th:if="${userRole}">
                <span th:text="${userName}">Usuario</span> · <span th:text="${userRole}">Rol</span>
                <span th:if="${patientCount != null}"> · <span th:text="${patientCount}">0</span> paciente(s)</span>
            </span>
        </div>
        <h1 th:if="${userRole != null and #strings.toLowerCase(userRole).contains('caregiver')}">Alertas de Mis Pacientes</h1>
        <h1 th:if="${userRole != null and #strings.toLowerCase(userRole).contains('patient')}">Mis Alertas</h1>
        <h1 th:if="${userRole == null or (!#strings.toLowerCase(userRole).contains('caregiver') and !#strings.toLowerCase(userRole).contains('patient'))}">Alertas del Sistema</h1>
        
        <p th:if="${#lists.isEmpty(alerts)}" style="background: #f3f4f6; border-radius: 8px; padding: 1.5rem; text-align: center; color: #6b7280;">
            <span th:if="${userRole != null and #strings.toLowerCase(userRole).contains('caregiver')}">
                No hay alertas activas para tus pacientes.
            </span>
            <span th:if="${userRole != null and #strings.toLowerCase(userRole).contains('patient')}">
                No tienes alertas activas en este momento.
            </span>
            <span th:if="${userRole == null or (!#strings.toLowerCase(userRole).contains('caregiver') and !#strings.toLowerCase(userRole).contains('patient'))}">
                No hay alertas en el sistema actualmente.
            </span>
        </p>
        
        <div class="alerts-list" th:if="${!#lists.isEmpty(alerts)}">
            <div class="alert-card" th:each="alert : ${alerts}" 
                 th:classappend="${alert.alertLevelId != null ? alert.alertLevelId : 'medium'}">
                <div class="alert-header">
                    <span class="alert-id" th:text="'ID: ' + ${alert.id}">ID: alert-123</span>
                    <span class="alert-status" th:text="${alert.statusId}" 
                          th:classappend="${alert.statusId}">active</span>
                </div>
                <p class="alert-description" th:text="${alert.description ?: 'Sin descripción'}">
                    Descripción de la alerta
                </p>
                <div class="alert-footer">
                    <span th:text="${alert.createdAt ?: 'Fecha desconocida'}">2025-01-01</span>
                    <form method="post" th:action="@{'/alerts/' + ${alert.id} + '/ack'}" 
                          th:if="${alert.statusId == 'created' or alert.statusId == 'notified'}">
                        <button type="submit" class="btn-ack">Reconocer</button>
                    </form>
                </div>
            </div>
        </div>
    </section>
</main>
</body>
</html>
