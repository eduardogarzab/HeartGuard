{{define "superadmin/user_locations.html"}} {{template "layout" .}} {{end}} {{define "superadmin/user_locations.html:content"}}
<section class="hg-section">
	<div class="hg-flex-between">
		<h1>Ubicaciones de usuarios</h1>
	</div>
	<div class="hg-card">
		<form method="get" action="/superadmin/locations/users" class="hg-form-grid">
			<div class="hg-form-field">
				<label for="user-filter">Usuario</label>
				<select id="user-filter" name="user_id">
					<option value="">Todos</option>
					{{range .Data.Users}}
					<option value="{{.ID}}" {{if eq $.Data.SelectedUserID .ID}}selected{{end}}>{{.Name}} {{if .Email}}({{.Email}}){{end}}</option>
					{{end}}
				</select>
			</div>
			<div class="hg-form-field">
				<label for="user-from">Desde</label>
				<input id="user-from" name="from" type="date" value="{{.Data.From}}" />
			</div>
			<div class="hg-form-field">
				<label for="user-to">Hasta</label>
				<input id="user-to" name="to" type="date" value="{{.Data.To}}" />
			</div>
			<div class="hg-form-actions">
				<button type="submit">Filtrar</button>
			</div>
		</form>
	</div>
</section>

<section class="hg-section">
	<div class="hg-card">
		<h3>Registrar ubicación manual</h3>
		<form method="post" action="/superadmin/locations/users" class="hg-form-grid">
			<input type="hidden" name="_csrf" value="{{.CSRFToken}}" />
			<input type="hidden" name="from" value="{{.Data.From}}" />
			<input type="hidden" name="to" value="{{.Data.To}}" />
			<div class="hg-form-field">
				<label for="user-select">Usuario</label>
				<select id="user-select" name="user_id" required>
					<option value="">Seleccione un usuario</option>
					{{range .Data.Users}}
					<option value="{{.ID}}" {{if eq $.Data.SelectedUserID .ID}}selected{{end}}>{{.Name}} {{if .Email}}({{.Email}}){{end}}</option>
					{{end}}
				</select>
			</div>
			<div class="hg-form-field">
				<label for="user-recorded">Fecha y hora</label>
				<input id="user-recorded" name="recorded_at" type="datetime-local" />
			</div>
			<div class="hg-form-field">
				<label for="user-latitude">Latitud</label>
				<input id="user-latitude" name="latitude" type="number" step="any" min="-90" max="90" required />
			</div>
			<div class="hg-form-field">
				<label for="user-longitude">Longitud</label>
				<input id="user-longitude" name="longitude" type="number" step="any" min="-180" max="180" required />
			</div>
			<div class="hg-form-field">
				<label for="user-accuracy">Precisión (m)</label>
				<input id="user-accuracy" name="accuracy_m" type="number" step="any" min="0" />
			</div>
			<div class="hg-form-field">
				<label for="user-source">Fuente</label>
				<input id="user-source" name="source" type="text" maxlength="40" placeholder="GPS, manual, etc." />
			</div>
			<div class="hg-form-actions">
				<button type="submit">Guardar ubicación</button>
			</div>
		</form>
	</div>
</section>

<section class="hg-section">
	<div class="hg-card">
		<h3>Historial de ubicaciones</h3>
		<table class="hg-table">
			<thead>
				<tr>
					<th>Usuario</th>
					<th>Correo</th>
					<th>Registrada</th>
					<th>Latitud</th>
					<th>Longitud</th>
					<th>Fuente</th>
					<th>Precisión (m)</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				{{range .Data.Items}}
				<tr>
					<td>{{if .UserName}}{{.UserName}}{{else}}—{{end}}</td>
					<td>{{if .UserEmail}}{{.UserEmail}}{{else}}—{{end}}</td>
					<td>{{formatTime .RecordedAt}}</td>
					<td>{{printf "%.6f" .Latitude}}</td>
					<td>{{printf "%.6f" .Longitude}}</td>
					<td>{{if .Source}}{{.Source}}{{else}}—{{end}}</td>
					<td>{{if .AccuracyM}}{{formatFloat64 .AccuracyM 2}}{{else}}—{{end}}</td>
					<td class="hg-actions">
						<form method="post" action="/superadmin/locations/users/{{.ID}}/delete" data-hg-confirm="¿Eliminar ubicación?" class="hg-inline-form">
							<input type="hidden" name="_csrf" value="{{$.CSRFToken}}" />
							<input type="hidden" name="user_id" value="{{$.Data.SelectedUserID}}" />
							<input type="hidden" name="from" value="{{$.Data.From}}" />
							<input type="hidden" name="to" value="{{$.Data.To}}" />
							<button type="submit" class="hg-link hg-link-danger">Eliminar</button>
						</form>
					</td>
				</tr>
				{{else}}
				<tr>
					<td colspan="8" class="hg-empty-cell">Sin ubicaciones registradas.</td>
				</tr>
				{{end}}
			</tbody>
		</table>
	</div>
</section>
{{end}}
