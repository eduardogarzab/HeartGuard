{{define "superadmin/patients.html"}} {{template "layout" .}} {{end}} {{define "superadmin/patients.html:content"}}
<section class="hg-section">
	<div class="hg-flex-between">
		<h1>Pacientes</h1>
	</div>
	<div class="hg-card">
		<h3>Registrar paciente</h3>
		<form method="post" action="/superadmin/patients" class="hg-form-grid">
			<input type="hidden" name="_csrf" value="{{.CSRFToken}}" />
			<div class="hg-form-field">
				<label for="patient-name">Nombre</label>
				<input id="patient-name" name="name" type="text" required placeholder="Nombre completo" />
			</div>
			<div class="hg-form-field">
				<label for="patient-email">Correo</label>
				<input id="patient-email" name="email" type="email" required placeholder="correo@ejemplo.com" />
			</div>
			<div class="hg-form-field">
				<label for="patient-org">Organización</label>
				<select id="patient-org" name="org_id">
					<option value="">Sin organización</option>
					{{range .Data.Organizations}}
					<option value="{{.ID}}">{{.Name}}</option>
					{{end}}
				</select>
			</div>
			<div class="hg-form-field">
				<label for="patient-birthdate">Fecha de nacimiento</label>
				<input id="patient-birthdate" name="birthdate" type="date" />
			</div>
			<div class="hg-form-field">
				<label for="patient-sex">Sexo</label>
				<select id="patient-sex" name="sex_code">
					<option value="">Sin especificar</option>
					{{range .Data.Sexes}}
					<option value="{{.Code}}">{{.Label}}</option>
					{{end}}
				</select>
			</div>
			<div class="hg-form-field">
				<label for="patient-risk">Nivel de riesgo</label>
				<select id="patient-risk" name="risk_level_id">
					<option value="">No asignado</option>
					{{range .Data.RiskLevels}}
					<option value="{{.ID}}">{{.Label}}</option>
					{{end}}
				</select>
			</div>
			<div class="hg-form-field">
				<label for="patient-photo">URL de la foto</label>
				<input id="patient-photo" name="profile_photo_url" type="url" placeholder="https://..." />
			</div>
			<div class="hg-form-field">
				<label for="patient-password">Contraseña</label>
				<input id="patient-password" name="password" type="password" required placeholder="Contraseña temporal" />
			</div>
			<div class="hg-form-actions">
				<button type="submit">Crear paciente</button>
			</div>
		</form>
	</div>
</section>

<section class="hg-section">
	<div class="hg-card">
		<h3>Pacientes registrados</h3>
		<table class="hg-table">
			<thead>
				<tr>
					<th></th>
					<th>Nombre</th>
					<th>Correo</th>
					<th>Organización</th>
					<th>Sexo</th>
					<th>Riesgo</th>
					<th>Nacimiento</th>
					<th>Creado</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				{{range .Data.Items}}
				{{$patient := .}}
				<tr>
					<td>
						<a href="/superadmin/patients/{{$patient.ID}}">
							<img src="{{if .ProfilePhotoURL}}{{.ProfilePhotoURL}}{{else}}/ui-assets/img/patient_placeholder.svg{{end}}" alt="Foto de perfil" class="hg-avatar" />
						</a>
					</td>
					<td><a href="/superadmin/patients/{{$patient.ID}}">{{$patient.Name}}</a></td>
					<td>{{$patient.Email}}</td>
					<td>{{if $patient.OrgName}}{{$patient.OrgName}}{{else}}—{{end}}</td>
					<td>{{if $patient.SexLabel}}{{$patient.SexLabel}}{{else}}—{{end}}</td>
					<td>{{if $patient.RiskLevelLabel}}{{stringValue $patient.RiskLevelLabel}}{{else}}—{{end}}</td>
					<td>{{formatDatePtr $patient.Birthdate}}</td>
					<td>{{formatTime $patient.CreatedAt}}</td>
					<td class="hg-flex">
						<details>
							<summary>Editar</summary>
							<form method="post" action="/superadmin/patients/{{$patient.ID}}/update" class="hg-form-grid">
								<input type="hidden" name="_csrf" value="{{$.CSRFToken}}" />
								<div class="hg-form-field">
									<label>Nombre</label>
									<input name="name" type="text" value="{{$patient.Name}}" required />
								</div>
								<div class="hg-form-field">
									<label>Correo</label>
									<input name="email" type="email" value="{{$patient.Email}}" required />
								</div>
								<div class="hg-form-field">
									<label>Organización</label>
									<select name="org_id">
										<option value="">Sin organización</option>
										{{range $.Data.Organizations}}
										<option value="{{.ID}}" {{if eq .ID (stringValue $patient.OrgID)}}selected{{end}}>{{.Name}}</option>
										{{end}}
									</select>
								</div>
								<div class="hg-form-field">
									<label>Fecha de nacimiento</label>
									<input name="birthdate" type="date" value="{{formatDatePtr $patient.Birthdate}}" />
								</div>
								<div class="hg-form-field">
									<label>Sexo</label>
									<select name="sex_code">
										<option value="">Sin especificar</option>
										{{range $.Data.Sexes}}
										<option value="{{.Code}}" {{if eq .Code (stringValue $patient.SexCode)}}selected{{end}}>{{.Label}}</option>
										{{end}}
									</select>
								</div>
								<div class="hg-form-field">
									<label>Riesgo</label>
									<select name="risk_level_id">
										<option value="">No asignado</option>
										{{range $.Data.RiskLevels}}
										<option value="{{.ID}}" {{if eq .ID (stringValue $patient.RiskLevelID)}}selected{{end}}>{{.Label}}</option>
										{{end}}
									</select>
								</div>
								<div class="hg-form-field">
									<label>URL de la foto</label>
									<input name="profile_photo_url" type="url" value="{{stringValue $patient.ProfilePhotoURL}}" />
								</div>
								<div class="hg-form-field">
									<label>Contraseña (opcional)</label>
									<input name="password" type="password" placeholder="Dejar en blanco para mantener" />
								</div>
								<div class="hg-form-actions">
									<button type="submit">Guardar</button>
								</div>
							</form>
						</details>
						<form method="post" action="/superadmin/patients/{{$patient.ID}}/delete" data-hg-confirm="¿Eliminar paciente?" class="hg-inline-form">
							<input type="hidden" name="_csrf" value="{{$.CSRFToken}}" />
							<button type="submit" class="hg-link hg-link-danger">Eliminar</button>
						</form>
					</td>
				</tr>
				{{else}}
				<tr>
					<td colspan="9" class="hg-empty-cell">Sin pacientes registrados.</td>
				</tr>
				{{end}}
			</tbody>
		</table>
	</div>
</section>
{{end}}
