{{define "superadmin/dashboard.html"}} {{template "layout" .}} {{end}} {{define "superadmin/dashboard.html:content"}}
<section class="hg-section">
	<div class="hg-dashboard-heading">
		<div>
			<h1>Panel</h1>
			<p class="hg-section-subtitle">Resumen ejecutivo del entorno superadmin</p>
		</div>
		<div class="hg-dashboard-actions">
			<a class="hg-link-button" href="/superadmin/dashboard/export?format=pdf">Exportar PDF</a>
			<a class="hg-link-button hg-button-muted" href="/superadmin/dashboard/export?format=csv">Exportar CSV</a>
		</div>
	</div>
</section>

<section class="hg-section">
	<header class="hg-dashboard-section-header">
		<div>
			<h2>Inteligencia Estratégica</h2>
			<p>KPIs clave sobre la eficacia de las alertas y la eficiencia operativa del equipo clínico.</p>
		</div>
		<form method="get" class="hg-time-filter">
			{{range .Data.TimeFilterOptions}}
			<button name="period" type="submit" value="{{.Value}}" class="hg-link-button {{if .IsActive}}is-active{{end}}">{{.Label}}</button>
			{{end}}
		</form>
	</header>
	<div class="hg-dashboard-kpis">
		{{if .Data.ResponseStats}}
		<article class="hg-kpi-card">
			<span class="hg-kpi-label">Tiempo Medio de Acuse (MTTA)</span>
			<span class="hg-kpi-value">{{if gt (.Data.ResponseStats.AvgAckDuration.Seconds) 0.0}}{{formatDuration .Data.ResponseStats.AvgAckDuration}}{{else}}—{{end}}</span>
			<span class="hg-kpi-caption">Tiempo promedio para acusar alertas.</span>
		</article>
		<article class="hg-kpi-card">
			<span class="hg-kpi-label">Tiempo Medio de Resolución (MTTR)</span>
			<span class="hg-kpi-value">{{if gt (.Data.ResponseStats.AvgResolveDuration.Seconds) 0.0}}{{formatDuration .Data.ResponseStats.AvgResolveDuration}}{{else}}—{{end}}</span>
			<span class="hg-kpi-caption">Tiempo promedio para resolver alertas.</span>
		</article>
		{{else}}
		<p class="hg-chart-empty">No hay datos de respuesta a alertas en este período.</p>
		{{end}}
	</div>
	<div class="hg-dashboard-grid">
		<article class="hg-chart-card">
			<header>
				<h3>Salud de la Población</h3>
				<span class="hg-chart-meta">Distribución por Nivel de Riesgo ({{.Data.Overview.ActivePatientsCount}} Pacientes Activos)</span>
			</header>
			{{if .Data.PatientRiskChart}}
			<div class="hg-chart-visual">
				<canvas id="hgChartPatientRisk" class="hg-chart-canvas" data-hg-type="doughnut" data-hg-series-label="Pacientes" data-hg-chart="{{toJSON .Data.PatientRiskChart}}"></canvas>
			</div>
			<div class="hg-chart-bars hg-chart-fallback">
				{{range $idx, $entry := .Data.PatientRiskChart}}
				<div class="hg-chart-bar" data-hg-entry-index="{{$idx}}">
					<span class="hg-chart-bar-label">{{$entry.Label}}</span>
					<div class="hg-chart-bar-track">
						<div class="hg-chart-bar-fill is-{{$entry.State}}" style="--hg-bar-width: {{$entry.Width}}"></div>
					</div>
					<span class="hg-chart-bar-count">{{$entry.Count}}</span>
				</div>
				{{end}}
			</div>
			{{else}}
			<p class="hg-chart-empty">Sin datos de riesgo de pacientes.</p>
			{{end}}
		</article>
		<article class="hg-chart-card">
			<header>
				<h3>Calidad de Alertas</h3>
				<span class="hg-chart-meta">Resultados de Triaje ({{.Data.SelectedTimeFilter | formatTimeFilter}})</span>
			</header>
			{{if .Data.AlertOutcomeChart}}
			<div class="hg-chart-visual">
				<canvas id="hgChartAlertOutcomes" class="hg-chart-canvas" data-hg-type="bar" data-hg-index-axis="y" data-hg-series-label="Alertas" data-hg-chart="{{toJSON .Data.AlertOutcomeChart}}"></canvas>
			</div>
			{{else}}
			<p class="hg-chart-empty">Sin resultados de alertas en este período.</p>
			{{end}}
		</article>
		<article class="hg-chart-card">
			<header>
				<h3>Volumen de Inferencias por Tipo</h3>
				<span class="hg-chart-meta">Distribución de eventos detectados</span>
			</header>
			{{if .Data.InferenceChart}}
			<div class="hg-chart-visual">
				<canvas id="hgChartInference" class="hg-chart-canvas" data-hg-type="bar" data-hg-index-axis="y" data-hg-series-label="Inferencias" data-hg-chart="{{toJSON .Data.InferenceChart}}"></canvas>
			</div>
			{{else}}
			<p class="hg-chart-empty">No hay datos de inferencias disponibles.</p>
			{{end}}
		</article>
	</div>
</section>

<section class="hg-section">
	<header class="hg-dashboard-section-header">
		<div>
			<h2>Métricas Operativas y de Adopción</h2>
			<p>Salud del sistema, estado de cuentas e invitaciones.</p>
		</div>
	</header>
	{{if .Data.Overview}}
	<div class="hg-dashboard-kpis">
		<article class="hg-kpi-card">
			<span class="hg-kpi-label">Pacientes Activos</span>
			<span class="hg-kpi-value">{{.Data.Overview.ActivePatientsCount}}</span>
			<span class="hg-kpi-caption">Pacientes con monitoreo activo.</span>
		</article>
		<article class="hg-kpi-card">
			<span class="hg-kpi-label">Alertas creadas</span>
			<span class="hg-kpi-value">{{.Data.AlertsCreatedCount}}</span>
			<span class="hg-kpi-caption">Alertas generadas en el periodo seleccionado.</span>
		</article>
		<article class="hg-kpi-card">
			<span class="hg-kpi-label">Dispositivos Desconectados</span>
			<span class="hg-kpi-value">{{.Data.Overview.DisconnectedDevicesCount}}</span>
			<span class="hg-kpi-caption">Dispositivos que no han reportado recientemente.</span>
		</article>
		<article class="hg-kpi-card">
			<span class="hg-kpi-label">Tiempo de Respuesta API</span>
			<span class="hg-kpi-value">{{printf "%.0f ms" .Data.Overview.AvgResponseMs}}</span>
			<span class="hg-kpi-caption">Promedio en la última hora.</span>
		</article>
	</div>
	{{end}}
	<div class="hg-dashboard-grid">
		<article class="hg-chart-card">
			<header>
				<h3>Estado de Usuarios</h3>
				<span class="hg-chart-meta">Total: {{.Data.StatusTotal}}</span>
			</header>
			{{if .Data.StatusChart}}
			<div class="hg-chart-visual">
				<canvas id="hgChartStatus" class="hg-chart-canvas" data-hg-type="doughnut" data-hg-series-label="Usuarios" data-hg-chart="{{toJSON .Data.StatusChart}}"></canvas>
			</div>
			<div class="hg-chart-bars hg-chart-fallback">
				{{range $idx, $entry := .Data.StatusChart}}
				<div class="hg-chart-bar" data-hg-entry-index="{{$idx}}">
					<span class="hg-chart-bar-label">{{$entry.Label}}</span>
					<div class="hg-chart-bar-track">
						<div class="hg-chart-bar-fill is-{{$entry.State}}" style="--hg-bar-width: {{$entry.Width}}"></div>
					</div>
					<span class="hg-chart-bar-count">{{$entry.Count}}</span>
				</div>
				{{end}}
			</div>
			{{else}}
			<p class="hg-chart-empty">No hay datos de estado de usuarios.</p>
			{{end}}
		</article>
		<article class="hg-chart-card">
			<header>
				<h3>Estado de Invitaciones</h3>
				<span class="hg-chart-meta">Total: {{.Data.InvitationTotal}}</span>
			</header>
			{{if .Data.InvitationChart}}
			<div class="hg-chart-visual">
				<canvas id="hgChartInvitations" class="hg-chart-canvas" data-hg-type="doughnut" data-hg-series-label="Invitaciones" data-hg-chart="{{toJSON .Data.InvitationChart}}"></canvas>
			</div>
			<div class="hg-chart-bars hg-chart-fallback">
				{{range $idx, $entry := .Data.InvitationChart}}
				<div class="hg-chart-bar" data-hg-entry-index="{{$idx}}">
					<span class="hg-chart-bar-label">{{$entry.Label}}</span>
					<div class="hg-chart-bar-track">
						<div class="hg-chart-bar-fill is-{{$entry.State}}" style="--hg-bar-width: {{$entry.Width}}"></div>
					</div>
					<span class="hg-chart-bar-count">{{$entry.Count}}</span>
				</div>
				{{end}}
			</div>
			{{else}}
			<p class="hg-chart-empty">No hay invitaciones registradas.</p>
			{{end}}
		</article>
		<article class="hg-chart-card">
			<header>
				<h3>Salud de Infraestructura</h3>
				<span class="hg-chart-meta">Estado de Adherencia de Dispositivos</span>
			</header>
			{{if .Data.DeviceStatusChart}}
			<div class="hg-chart-visual">
				<canvas id="hgChartDeviceStatus" class="hg-chart-canvas" data-hg-type="doughnut" data-hg-series-label="Dispositivos" data-hg-chart="{{toJSON .Data.DeviceStatusChart}}"></canvas>
			</div>
			<div class="hg-chart-bars hg-chart-fallback">
				{{range $idx, $entry := .Data.DeviceStatusChart}}
				<div class="hg-chart-bar" data-hg-entry-index="{{$idx}}">
					<span class="hg-chart-bar-label">{{$entry.Label}}</span>
					<div class="hg-chart-bar-track">
						<div class="hg-chart-bar-fill is-{{$entry.State}}" style="--hg-bar-width: {{$entry.Width}}"></div>
					</div>
					<span class="hg-chart-bar-count">{{$entry.Count}}</span>
				</div>
				{{end}}
			</div>
			{{else}}
			<p class="hg-chart-empty">Sin datos de estado de dispositivos.</p>
			{{end}}
		</article>
		<article class="hg-chart-card is-wide is-full">
			<header>
				<h3>Actividad Reciente del Sistema</h3>
				<span class="hg-chart-meta">Eventos auditados en la última jornada</span>
			</header>
			{{if .Data.ActivitySeries}}
			<div class="hg-chart-visual hg-chart-visual--line">
				<canvas id="hgChartActivity" class="hg-chart-canvas" data-hg-type="line" data-hg-series-label="Eventos" data-hg-chart="{{toJSON .Data.ActivitySeries}}"></canvas>
			</div>
			{{end}} {{if .Data.RecentActivity}}
			<ul class="hg-activity-feed hg-activity-feed--compact">
				{{range .Data.RecentActivity}}
				<li>
					<strong>{{.Label}}</strong>
					<span>{{formatTime .Timestamp}}{{if .Actor}} &mdash; {{.Actor}}{{end}}{{if .Entity}} &middot; {{.Entity}}{{end}}</span>
				</li>
				{{end}}
			</ul>
			{{else}}
			<p class="hg-chart-empty">Sin actividad reciente en el sistema.</p>
			{{end}}
		</article>
	</div>
</section>
{{end}}
