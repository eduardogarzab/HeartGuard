<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Test Auth Response</title>
</head>
<body>
  <h1>Test de Autenticación</h1>
  <button id="testBtn">Probar Login</button>
  <pre id="output"></pre>

  <script type="module">
    const output = document.getElementById('output');
    
    document.getElementById('testBtn').addEventListener('click', async () => {
      output.textContent = 'Probando autenticación...\n';
      
      const xmlBody = `
        <login_request>
          <email>ana.ruiz@heartguard.com</email>
          <password>Demo#2025</password>
        </login_request>
      `;
      
      try {
        const response = await fetch('http://136.115.53.140:5000/auth/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/xml',
            'Accept': 'application/xml'
          },
          body: xmlBody
        });
        
        const text = await response.text();
        output.textContent += `\nStatus: ${response.status}\n`;
        output.textContent += `\nRespuesta XML:\n${text}\n`;
        
        // Intentar parsear
        const parser = new DOMParser();
        const xml = parser.parseFromString(text, 'application/xml');
        
        output.textContent += '\n--- Parseando XML ---\n';
        
        // Intentar diferentes selectores
        const selectors = [
          'access_token',
          'data access_token',
          'tokens access_token',
          'data tokens access_token',
          'response data tokens access_token'
        ];
        
        selectors.forEach(selector => {
          const node = xml.querySelector(selector);
          output.textContent += `Selector "${selector}": ${node ? 'ENCONTRADO' : 'no encontrado'}\n`;
          if (node) {
            output.textContent += `  Valor: ${node.textContent.substring(0, 50)}...\n`;
          }
        });
        
        // Mostrar estructura
        output.textContent += '\n--- Estructura del XML ---\n';
        const serializer = new XMLSerializer();
        output.textContent += serializer.serializeToString(xml);
        
      } catch (err) {
        output.textContent += `\nError: ${err.message}\n`;
        output.textContent += err.stack;
      }
    });
  </script>
</body>
</html>
